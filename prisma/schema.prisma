// ## App description
// This app is meant for people who want to have a training contract with their pal, so they will stick to training.
// The app will allow users to create a contract, add obligations and sign up on it.

// An obligation has:
// A title and a description.
// Each contract-bound obligation has a due date/interval+amount of times to interval, so the users will have their contract timed.

// A contract has:
// A due date, obligations, 2+ signatures from 2 different users.
// Each user can either terminate the contract and by doing that it will be finished for the both of them.
// Termination is modeled in the db, to know who did it and why.

// A user can checkmark an obligation as done (Or recheck it to undo it) and that will send a notification to all those who partake in the contract.

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model AppUser {
  id          String  @id @default(auto()) @map("_id") @db.ObjectId
  userId      String  @unique
  email       String  @unique
  displayName String?
  photoURL    String?

  userContracts UserContracts[]

  @@map("appUser")
}

model Obligation {
  obligationId String  @id @default(auto()) @map("_id") @db.ObjectId
  userId       String
  title        String
  emoji        String?
  description  String?
  repeat       String // "Daily" | "Weekly"
  days         Int[]   @default([])
  timesAWeek   Int?

  contractObligations ContractObligations[]

  @@map("obligation")
}

model Contract {
  contractId  String   @id @default(auto()) @map("_id") @db.ObjectId
  creatorId   String
  title       String
  description String?
  dueDate     DateTime

  contractObligations ContractObligations[]
  userContracts       UserContracts[]

  @@map("contract")
}

model ContractObligations {
  contractObligationId String @id @default(auto()) @map("_id") @db.ObjectId
  contractId           String @db.ObjectId
  obligationId         String @db.ObjectId

  contract   Contract?   @relation(fields: [contractId], references: [contractId])
  obligation Obligation? @relation(fields: [obligationId], references: [obligationId])

  @@map("contractObligations")
}

model UserContracts {
  userContractId String    @id @default(auto()) @map("_id") @db.ObjectId
  userId         String
  contractId     String    @db.ObjectId
  signedAt       DateTime?

  appUser  AppUser  @relation(fields: [userId], references: [userId])
  contract Contract @relation(fields: [contractId], references: [contractId])

  @@map("userContracts")
}
